[TOC]

# 0 概述

**PCI总线0**上**存储器控制器(Device 0**)是一个比较**特殊的PCI设备**, 这个设备除了需要**管理DDR SDRAM**之外, 还**管理整个存储器域的地址空间**, 包括**PCI总线域地址空间**. 在x86处理器系统中, 该设备是管理存储器域空间的重要设备, 其中含有许多**与存储器空间相关的寄存器**.

这些**寄存器**对于系统程序员理解x86处理器的存储器拓扑结构非常重要, 底层编程需要掌握这些寄存器. 但是在x86处理器系统中, 由于BIOS的存在, 多数程序员没有机会使用这些寄存器.

从底层开发角度, x86处理器系统不如PowerPC, MIPS和ARM处理器透明. x86处理器首先使用BIOS屏蔽处理器的硬件实现细节,其次在处理器内核中使用了microcode进一步屏蔽了CPU的实现细节. 使得底层程序员在没有得到充分的资源时, 几乎无法开发x86处理器的底层代码.

但不可否认的是x86处理器底层开发的复杂程度超过PowerPC, MIPS和ARM处理器, 因为x86处理器系统作为通用CPU需要与各类操作系统兼容, 而向前兼容对于任何一种处理器都是一个巨大的包袱. x86处理器系统使用BIOS和Microcode屏蔽硬件细节基于技术和商业考虑.

从传统外部设备的角度看, PCI总线0的Device 0并不是一个设备, 仅存放与处理器系统密切相关的一组参数. 而除了x86处理器外, 几乎所有处理器都使用存储器映射寻址的寄存器保存这些参数.

在Montevina平台, **系统软件**使用**Type 00h**配置**请求访问存储器控制器**, 该**存储器控制器**除了具有一个**标准的PCI Agent设备**的**64B的配置空间**之外, 还使用了**PCI设备的扩展配置空间**, 其包含的主要寄存器如表.

![config](./images/2.png)

Device 0使用的**基本配置空间**与**其他PCI设备兼容**. 

注意, **Device 0**在**PCIe体系结构**中, 被认为是**HOST主桥(！！！**). 而**Device 0**使用的**PCI扩展配置空间**也被称为**RCRB**, RCRB主要作用是描述当前处理器的存储器地址拓扑结构, 包括主存储器地址和PCI总线地址. 其简写和复位值如图.

