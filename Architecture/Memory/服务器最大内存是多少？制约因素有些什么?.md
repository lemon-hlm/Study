
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [0 概述](#0-概述)
* [1 CPU内核和操作系统](#1-cpu内核和操作系统)
* [2 内存子系统](#2-内存子系统)
* [参考](#参考)

<!-- /code_chunk_output -->

# 0 概述

24TB这个数字，框定了利润的上限，这是更多的金钱所不能突破的。

这带来一个根本性的问题，单机服务器最大内存的极限是怎么确定的？它的制约因素有哪些？为了简化讨论范围，我们限定在占据服务器市场98%以上的**X86服务器**，并假设不受成本的约束。我们从CPU内核和操作系统、以及存储子系统两方面来寻找答案。

# 1 CPU内核和操作系统

操作系统和CPU内核都支持６４位地址空间，它能够访问的地址空间是

2＾64＝16384 PB

好大的空间，似乎永远也用不完。是不是这个是内存容量的极限呢？实际上即使在CPU内核中还有一个因子，限制了CPU和操作系统的寻址空间，那就是bitwidth。它决定了页表转换的地址长度，它现在最大是48位，根据64位最大地址转换, 能有52位最大物理地址.

2＾52＝4096 TB

是不是这就是内存容量的极限了呢？实际上并不是。

# 2 内存子系统

现代计算机系统的内存都由CPU内置的内存控制器来管理，为了寻找内存的极限，我们把目光投入到志强中的战斗机，**E7服务器**上。

E7面向对高可靠性和高可扩展性需求强烈的用户，当然价格也十分感人。高可靠性说的是RAS，高可扩展性是说可以扩展为**4路**，8路，甚至16路服务器。所谓n路，通俗的说就是有n个物理CPU。

16路服务器十分十分罕见，部分原因在于从8路扩展为16路后，保证cache一致性所发的snoop包会降低性能，在某些情况下得不偿失。我们这里就略过。8路服务器作为主流最高端服务器，它的内存最大能够达到多少呢？

我们先来看一下它的内存子系统：

# 参考

- 本文章参考: 微信公众账号UEFIBlog, [点此进入文章](https://mp.weixin.qq.com/s?__biz=MzI2NDYwMDAxOQ==&mid=2247484239&idx=1&sn=7de79a00bcfcb0732b27d946e0c78258&chksm=eaab63f3dddceae5dacdd78547b5ee1a9ea43d217c7aec3a117d51ff5d59155422564251c1cb&mpshare=1&scene=1&srcid=#rd)
