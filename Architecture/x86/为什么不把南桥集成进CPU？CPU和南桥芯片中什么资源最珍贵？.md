
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [1 南桥的江湖地位问题](#1-南桥的江湖地位问题)
* [2 为什么不是SOC](#2-为什么不是soc)
* [3 什么是HSIO？](#3-什么是hsio)
* [参考](#参考)

<!-- /code_chunk_output -->

南桥芯片，这个统管外部IO的芯片组，正在逐步变得面目可憎起来。经历了ICH到PCH的转变，越来越多的人都在质疑它的存在。为什么不把PCH集成进CPU中？**DMI 4个lane**的小水管下面带那么多PCIe root port加各种USB 3.0/3.1和SATA port，会不会肠梗阻？今天我们一起来分析一下这么做背后深层次的原因。

# 1 南桥的江湖地位问题

熟悉计算机系统演变历史的小伙伴们都知道。很久很久以前（也没有多久了），计算机主板上有**CPU**、**北桥（MCH**）和**南桥（ICH**）这三个主要的芯片：

![](./images/2019-04-22-16-59-59.png)

由于**FSB**变成了**系统效能的瓶颈**和**对多CPU的制约**，在**台式机**和**笔记本**电脑中，**MCH**被请进**CPU中**，**服务器**市场虽然短暂的出现了**IOH**，但也慢慢的**被CPU吞噬**。

前后简单的对比:

![](./images/2019-04-22-17-01-31.png)

注: 上面的是Intel G45和Intel H55芯片组

**CPU中MCH原来的部分(！！！**), 在**桌面CPU**中叫做System Agent(SA), 在**服务器CPU**中叫做**uncore(和内核core对应**). 它基本还负责原来的功能, 那就是 **内存管理(！！！内存控制器在CPU里面？？？**) 和提供 **至少16个Lane** 的**PCIe Root port(！！！RC在CPU里面？？**)来驱动**显卡！！！**(服务器uncore还包括QPI). 

这绝不是表面看起来“换个马甲”这么简单。脱离了**FSB这条小细管道**，**内存控制器**、**PICe Root Port的root complex**和**内核**之间的通信变成了**ring bus**乃至**目前的Mesh网络**这种**片内总线**，羊肠小路变成了高速公路。如此改变让原来的瓶颈消失了，计算机效能才在酷睿后有了质的飞跃。

作为统管大部分IO设备的江湖大佬，ICH到PCH的转变却十分的小，时至今日，除了**DMI**随着**PCIe 3.0**升级到**DMI 3.0**，和增加了更多的功能外，变化相对较小。很多人看他不顺眼，欲除之而后快，让江湖最后一个大佬CPU一统主板。

如果也把**PCH整合进CPU**，**单芯片解决方案！！！**，也就是**SOC(System On a Chip！！！**)，会带来很多好处：

- 主板可以更便宜。少一块芯片的钱，主板设计简单一些，线路少些，这些都会帮助主板成本下降。
- **南桥的设备**可以摆脱**DMI 3.0 8Gbps \* 4**的带宽限制。如果我们把PCH中高速的USB 3.0/3.1， SATA ports和PCIe root ports提供的带宽都加在一起，我们就会发现这个数字会远远高于DMI 3.0能够提供的带宽。如果将南桥整合进CPU，这些设备也就可以和原北桥的PCIe root port一样接入IOSF骨干bus，摆脱DMI小水管。

# 2 为什么不是SOC

现实中我们除了看到**ATOM系列全部是SOC**、部分低端入门系列服务器是SOC（它原因比较有趣，我们今后再说）外，绝大部分主流系统PCH还是傲娇地继续战斗在第一线。这是为什么呢？

有两个原因十分明显：

- 集成进PCH会造成**CPU Die增大不少**，从而造成CPU良率下降很多，成本增加明显。这里有一篇讨论Die大小和良率的文章：[CPU制造的那些事之二：Die的大小和良品率](https://zhuanlan.zhihu.com/p/29767262)
- **PCH和CPU松耦合**，从而CPU和PCH可以单独生产，采用不同的工艺。实际上，**CPU**往往采用**最新的制程**，而**PCH**往往使用**前期的制程**。

还有一个十分重要的原因，也许是最重要的原因，往往不被人所知，那就是**CPU的引脚pin不够用了**！

如果我们看现在的CPU引脚，因为内存channel的不断增加和一些新的功能，LGA封装的引脚不断增加，一千多个引脚密密麻麻蔚为壮观。随便增加引脚会带来CPU兼容性的问题，Intel花了很大力气才能基本保证2年的引脚不变，而AMD则为了保证4年引脚兼容性更付出了巨大的代价，个中原因我们今后再讲。

如果我们再看**PCH的引脚**，就会发现它比CPU还要糟糕。几乎所有**低速的引脚**都**被复用**了，某些引脚甚至有三到四个功能！需要BIOS来选择（通过MUX）。**高速引脚**通过**HSIO**也被复用。

如果**PCH被整合到CPU**中，会给引脚问题带来灾难性的后果，而主板因为引脚的急剧增加，也对工艺和稳定性带来负面影响。

# 3 什么是HSIO？

**PCH的引脚**就那么多，而人们对**高速设备**，尤其是**USB host**和**PCIe root port**的需求却越来越大。在所有低速引脚已经被充分挖潜，而**低速引脚**和**高速引脚不能复用**（想想看为什么）的前提下，如何提供更多的高速设备，同时尽可能不很快增加引脚数量的问题被提上日程。

在引入Flex IO后，逐渐在所有PCH甚至ATOM SOC上，HSIO被作为一种高速设备复用技术被集成进入芯片中：



![](./images/2019-04-22-17-35-09.png)

# 参考

- https://zhuanlan.zhihu.com/p/47479121