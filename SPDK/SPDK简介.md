
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [1 简介](#1-简介)
* [2 软件体系结构概览](#2-软件体系结构概览)
	* [2.1 驱动代码运行在用户态](#21-驱动代码运行在用户态)
	* [2.2 轮询模式驱动(PMD)](#22-轮询模式驱动pmd)

<!-- /code_chunk_output -->

# 1 简介

**固态存储设备**正在取代**数据中心**。目前这一代的闪存存储，比起传统的磁盘设备，在**性能（performance**）、**功耗（power consumption**）和**机架密度（rack density**）上具有显著的优势。这些优势将会继续增大，使闪存存储作为下一代设备进入市场。

用户使用现在的**固态设备**，比如Intel® SSD DC P3700 Series Non\-Volatile Memory Express（NVMe）驱动，面临一个**主要的挑战**：因为**吞吐量**和**延迟性能**比传统的磁盘**好太多**，现在**总的处理时间**中，**存储软件**占用了**更大的比例**。换句话说，**存储软件栈**的**性能**和**效率**在整个存储系统中越来越重要。随着存储设备继续发展，它将面临远远超过正在使用的软件体系结构的风险（即**存储设备**受制于**相关软件的不足**而**不能发挥全部性能**），在接下来的几年中，存储设备将会继续发展到一个令人难以置信的地步。

为了帮助**存储OEM（设备代工厂**）和**ISV（独立软件开发商**）整合硬件，Inte构造了**一系列驱动**，以及一个**完善的**、**端对端**的**参考存储体系结构**，被命名为Storage Performance Development Kit（**SPDK**）。

SPDK的**目标**是通过**同时**使用**Intel的网络技术**，**处理技术**和**存储技术**来提高突出显著的**效率和性能**。通过运行**为硬件设计的软件**，SPDK已经证明很容易达到**每秒钟数百万次I/O读取**，通过使用许多处理器核心和许多NVMe驱动去存储，而**不需要额外卸载硬件**。

Intel在[BSD license](https://github.com/spdk/spdk/blob/master/LICENSE)许可协议下通过[Github](https://github.com/spdk)分发提供其全部的Linux参考架构的源代码。

博客、邮件列表和额外文档可以在[spdk.io](http://www.spdk.io/)中找到。

# 2 软件体系结构概览

SPDK如何工作？达到这样的超高性能运用了**两个关键技术**：**运行于用户态**和**轮询模式**。让我们进一步了解这两个软件工程术语。

## 2.1 驱动代码运行在用户态

首先，我们的**设备驱动代码运行在用户态**意味着，在定义上**驱动代码不会运行在内核**中。避免**内核上下文切换**和**中断**将会**节省大量的处理开销**，允许**更多的时钟周期**被用来做**实际的数据存储**。无论存储算法（去冗，加密，压缩，空白块存储）多么复杂，**浪费更少的时钟周期**总是意味着**更好的性能和延迟**。

这并**不是**说**内核增加了不必要的开销**；相反，**内核增加**了那些可能**不适用**于**专用存储堆栈**的**通用计算用例**的相关开销。

SPDK的**指导原则**是通过**消除每一处额外的软件开销**来提供**最少的延迟**和**最高的效率**。

## 2.2 轮询模式驱动(PMD)

其次，**轮询模式驱动**（Polled Mode Drivers, PMDs）改变了**I/O的基本模型**。

在**传统的I/O模型**中，**应用程序**提交读写请求后**睡眠**，一旦**I/O完成**，**中断**就会将其**唤醒**。PMDs的工作方式不同，应用程序提交读写请求后继续执行其他工作，以一定的时间间隔回头检查I/O是否已经完成。这种方式避免了中断带来的延迟和开销，并使得应用程序提高了I/O的效率。在旋转设备时代（磁带和机械硬盘），中断开销只占整个I/O时间的一个很小的百分比，因此给系统带来了巨大的效率提升。

然而，在**固态设备的时代**，持续引入更低延迟的持久化设备，中断开销成为了整个I/O时间中不能被忽视的部分。这个问题在更低延迟的设备上只会越来越严重。系统已经能够每秒处理数百万个I/O，所以消除数百万个事务的这种开销，能够快速地复制到多个内核中。数据包和数据块被立即分发，等待时间减小到最少，使得延迟更低，一致性延迟更多（抖动更少），吞吐量也得到提高。




参考

- http://aidaiz.com/spdk/
- 原文：[《Introduction to the Storage Performance Development Kit (SPDK)》](https://software.intel.com/en-us/articles/introduction-to-the-storage-performance-development-kit-spdk)