
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [ 1 libvirt架构说明](#1-libvirt架构说明)

<!-- /code_chunk_output -->

libvirt 以一组 API 的形式存在，主要用于管理应用程序。libvirt 通过一种特定于虚拟机监控程序的机制与每个有效的虚拟机监控程序进行通信，以完成API请求。

libvirt将物理主机称为结点（node），将客户机操作系统称为域（domain）。libvirt及其应用程序在宿主操作系统中运行。

# 1 libvirt架构说明

下面通过示意图对libvirt 架构进行介绍。没有使用libvirt的虚拟机管理方式如图 8\-1 所示，使用libvirt的虚拟机管理方式如图8-2所示。
￼
图8\-1 没有使用libvirt的虚拟机管理方式
￼
图8-2 使用libvirt的虚拟机管理方式

在图8-1和图8-2中：
● Node：一台独立的物理机器，即宿主机。
● Hypervisor：宿主机中运行的软件模块，可提供多个不同客户机操作系统的虚拟机。
● Domain：Hypervisor所提供的运行在虚拟机之上的客户机操作系统实例。
通过比较可以看出，libvirt 为各种虚拟化工具提供一套方便、可靠的编程接口，进而供应用程序调用，对应用开发者屏蔽了不同虚拟机监控程序的区别。
libvirt的控制方式有以下两种。
第一种方式管理应用程序和域位于同一结点上（如图 8-2 所示），管理应用程序通过 libvirt 工作，以控制本地域。
第二种方式管理应用程序和域位于不同的结点上（如图 8-3 所示）。该模式使用一种运行于远程结点上、名为 libvirtd 的特殊守护进程。当在新结点上安装 libvirt时，该程序会自动启动，且可自动确定本地虚拟机监控程序并为其安装驱动程序。该管理应用程序通过一种通用协议从本地 libvirt 连接到远程libvirtd。对于 QEMU，协议在 QEMU 监视器处结束。QEMU包含一个监测控制台，它允许检查运行中的来宾操作系统并控制虚拟机（VM）的各部分。
￼
图8-3 使用libvirt的远程虚拟机管理方式
为支持各种虚拟机监控程序的可扩展性，libvirt 实施一种基于驱动程序的架构，该架构允许一种通用的 API 以通用方式为大量潜在的虚拟机监控程序提供服务。这意味着：一些虚拟机监控程序的某些专业功能在 API 中不可见。另外，有些虚拟机监控程序可能不能实施所有的API功能，因而在特定的驱动程序内被定义为不受支持。图8-4展示了 libvirt API 与相关驱动程序的层次结构。这里也需要注意，libvirtd 提供从远程应用程序访问本地域的方式。
￼
图8-4 libvirt API 与相关驱动程序的层次结构
8.2.2 libvirt API控制接口
本节主要对libvirt API的主要准则和架构选择进行详细描述。
为了能够对支持各种主流操作系统的虚拟化管理工具进行控制，libvirt API公开了所有的资源。
1. libvirt对象
高级 libvirt API 可划分为5 个 API 部分，如图7-5所示。
