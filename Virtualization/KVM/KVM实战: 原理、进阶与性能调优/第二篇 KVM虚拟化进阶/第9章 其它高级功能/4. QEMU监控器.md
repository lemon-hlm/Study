
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [1 QEMU monitor的切换和配置](#1-qemu-monitor的切换和配置)

<!-- /code_chunk_output -->

QEMU监控器（monitor）是QEMU实现与用户交互的一种控制台，一般用于为QEMU模拟器提供较为复杂的功能，包括为客户机添加和移除一些媒体镜像（如CD-ROM、磁盘镜像等），暂停和继续客户机的运行，快照的建立和删除，从磁盘文件中保存和恢复客户机状态，客户机动态迁移，查询客户机当前各种状态参数等。在前面几章中，根据实际应用的具体场景已经多次提及一部分QEMU monitor中的命令了，本节将对QEMU monitor的使用和其中的常见命令进行介绍和总结。

# 1 QEMU monitor的切换和配置

要使用QEMU monitor，首先需要切换到monitor窗口中，然后才能使用命令来操作。
在默认情况下，在显示客户机的QEMU窗口中，按“Ctrl+Alt+2”组合键可以切换到QEMU monitor中，而从monitor窗口中按“Ctrl+Alt+1”组合键又可以回到客户机标准显示窗口。
当然，并非在所有情况下都使用“Ctrl+Alt+2”快捷键切换到monitor窗口，正如5.6.1节中介绍的那样，如果使用SDL显示，且在使用qemu命令行启动客户机时添加了“-alt-grab”或“-ctrl-grab”参数，则会使该组合键被对应修改为“Ctrl+Alt+Shift+2”或“右Ctrl+2”组合键。
如果所有的情况都一定要到图形窗口（SDL或VNC）才能操作QEMU monitor，那么在某些完全不能使用图形界面的情况下将会受到一些限制。其实，QEMU提供了如下的参数来灵活地控制monitor的重定向。

-monitor dev

该参数的作用是将monitor重定向到宿主机的dev设备上。关于dev设备这个选项的写法有很多种，下面简单介绍其中的几种。
（1）vc
即虚拟控制台（Virtual Console），不加“-monitor”参数就会使用“-monitor vc”作为默认参数。而且，还可以用于指定monitor虚拟控制台的宽度和长度，如“vc：800x600”表示宽度、长度分别为800像素、600像素，“vc：80Cx24C”则表示宽度、长度分别为80个字符宽和24个字符长，这里的C代表字符（character）。注意，只有选择这个“vc”为“-monitor”的选项时，利用前面介绍的“Ctrl+Alt+2”组合键才能切换到monitor窗口，其他情况下不能用这个组合键。
（2）/dev/XXX
使用宿主机的终端（tty），如“-monitor/dev/ttyS0”是将monitor重定向到宿主机的ttyS0串口上去，而且QEMU会根据QEMU模拟器的配置来自动设置该串口的一些参数。
（3）null
空设备，表示不将monitor重定向到任何设备上，无论怎样也不能连接上monitor。
（4）stdio
标准输入输出，不需要图形界面的支持。“-monitor stdio”将monitor重定向到当前命令行所在标准输入输出上，可以在运行qemu命令后直接默认连接到monitor中，操作起来非常方便，尤其是当需要使用较多QEMU monitor的命令时（这是笔者经常使用的方式，在前面一些章中已提及这种使用方式）。命令行示例如下：

[root@kvm-host ~]# qemu-system-x86_64 -enable-kvm -cpu host -smp 8 -m 16G -drive file=./rhel7.img,format=raw,if=virtio -device virtio-net-pci,netdev=nic0 -netdev bridge,id=nic0,br=virbr0 -monitor stdio￼ QEMU 2.7.0 monitor - type 'help' for more information￼ (qemu) help device_add￼ device_add driver[,prop=value][,...] -- add device, like -device on the command line￼ (qemu)

上面的命令行中演示了通过qemu命令行启动客户机后，标准输入输出中显示了QEMU monitor，然后在monitor中运行了“help device_add”命令来查看“device_add”命令的帮助手册。
9.4.2　常用命令介绍
前面一些章节中已经根据示例介绍和使用过QEMU monitor中不少的命令了。本节将系统地选择其中一些重要的命令进行简单介绍，以便读者对monitor中命令的功能有一个全面的认识。
1.help显示帮助信息
help命令可以显示其他命令的帮助信息，其命令格式为：

help 或 ? [cmd]

“help”与“？”命令是同一个命令，都是显示命令的帮助信息。它后面不加cmd命令作为参数时，help命令（单独的“help”或“？”）将显示该QEMU中支持的所有命令及其简要的帮助手册。当有cmd参数时，“help cmd”将显示cmd命令的帮助信息，如果cmd不存在，则帮助信息输出为空。
在monitor中使用help命令的几个示例，命令行操作如下：
