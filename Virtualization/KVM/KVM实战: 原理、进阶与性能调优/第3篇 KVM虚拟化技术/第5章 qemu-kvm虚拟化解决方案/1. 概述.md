
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->



<!-- /code_chunk_output -->

KVM全称是Kernel\-based Virtual Machine，是一个基于Linux环境的开源虚拟化解决方案。

与 Xen、VMware 等提供完整解决方案的商业化虚拟产品不同，KVM的**思想**是在**Linux内核的基础**上添加**虚拟机管理模块**，重用Linux内核中已经完善的进程调度、内存管理、IO管理等部分，使之成为一个可以支持运行虚拟机的Hypervisor。因此，KVM并不是一个完整的模拟器，而只是一个提供了虚拟化功能的内核插件，具体的模拟器工作是借助QEMU来完成的，二者的架构区别如图5-1所示。
￼
图5-1 KVM和Xen虚拟化方案比较:

![](./images/2019-07-05-12-04-36.png)

在**Xen**的体系结构中，**Xen Hypervisor**运行于**硬件之上**，并且将系统资源进行了虚拟化操作，将虚拟化的资源分配给上层的虚拟机（VM），然后通过虚拟机VM来运行相应的客户机操作系统。

在KVM中，**一个虚拟机**就是一个**传统的Linux中的线程**，拥有自己的PID号，也可以被kill系统调用直接杀死（在这种情况下，虚拟机的行为表现为“突然断电”）。在一个Linux系统中，有多少个VM，就有多少个进程，如图5\-2所示。

在VM的进程信息中，除了可以看到进程号、UID号等基本进程参数以外，还能看到该虚拟机的启动命令，是通过 qemu\-kvm 来进行的，相关的控制开关作为命令行参数输入，如虚拟映像对应的磁盘、虚拟网卡、VNC设置、显卡设置和IO设置等。这些参数都可以从QEMU的文档中找到。
￼
图5-2 qemu-kvm虚拟机的运行时进程信息:

![](./images/2019-07-05-12-04-51.png)

KVM是基于硬件辅助虚拟化技术（Intel的VT\-x或者AMD\-V）的全虚拟化解决方案，客户机操作系统能够不经过修改直接在 KVM 的虚拟机中运行，每一台虚拟机能够享有独立的虚拟硬件资源：网卡、磁盘、图形适配器等。

**KVM**支持**虚拟化嵌套**，即在虚拟化出来的主机中，KVM能够再次进行虚拟机中的虚拟化，但是此项功能只针对KVM，不支持Xen、VMwaer等其他虚拟化架构方案。