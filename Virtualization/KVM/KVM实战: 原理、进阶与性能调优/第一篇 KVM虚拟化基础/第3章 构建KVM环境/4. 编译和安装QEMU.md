
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [1 曾经的qemu\-kvm](#1-曾经的qemu-kvm)
* [2 下载QEMU源代码](#2-下载qemu源代码)

<!-- /code_chunk_output -->

除了在内核空间的KVM模块之外，在用户空间需要QEMU￼来模拟所需要的CPU和设备模型，以及启动客户机进程，这样才有了一个完整的KVM运行环境。

在编译和安装了KVM并且启动到编译的内核之后，下面来看一下QEMU的编译和安装。

# 1 曾经的qemu\-kvm

在上一版中，我们是以qemu\-kvm为例来讲解QEMU/KVM的。qemu-kvm原本是kernel社区维护的**专门用于KVM的QEMU的分支**。

在**2012年**年末的时候，这个分支**并入了主流的QEMU**（ git://git.qemu-project.org/qemu.git ）。从此，不再需要特殊的qemu-kvm，而只是**通用的QEMU**加上\-\-e**nable\-kvm**选项就可以创建KVM guest了。

# 2 下载QEMU源代码

在并入主流QEMU以后，目前的QEMU项目针对KVM/x86的部分依然是由Redhat公司的Paolo Bonzini作为维护者（Maintainer），代码的**git url**托管在https://www.qemu.org/ 上。

QEMU开发代码仓库的网页连接为：http://git.qemu.org/qemu.git 。
其中，可以看到有如下2个URL链接可供下载开发中的最新qemu-kvm的代码仓库。

```
git://git.qemu.org/qemu.git￼
http://git.qemu.org/git/qemu.git
```

可以根据自己实际需要选择当中任一个，用git clone命令下载即可，它们是完全一样的。
另外，也可以到以下下载链接中根据需要下载最近几个发布版本的代码压缩包。

http://wiki.qemu.org/Download

在本节后面讲解编译时，是以下载开发中的最新的qemu.git为例的。获取其代码仓库过程如下：

[root@kvm-host ~]# git clone git://git.qemu.org/qemu.git￼ Cloning into 'qemu'...￼ remote: Counting objects: 294725, done.￼ remote: Compressing objects: 100% (59425/59425), done.￼ remote: Total 294725 (delta 238595), reused 289874 (delta 234513)￼ Receiving objects: 100% (294725/294725), 94.23 MiB | 37.66 MiB/s, done.￼ Resolving deltas: 100% (238595/238595), done.￼ [root@kvm-host ~]# cd qemu￼ [root@kvm-host qemu]# ls￼ accel.c   CODING_STYLE   dtc   kvm-all.c   numa.c   qemu-io.c    README     target-mips             trace￼ <!- 此处省略qemu文件夹下众多文件及子文件夹 ->

3.4.3　配置和编译QEMU
QEMU的配置并不复杂，通常情况下，直接运行代码仓库中configure文件进行配置即可。当然，如果对其配置不熟悉，可以运行“./configure--help”命令查看配置的一些选项及其帮助信息。
显示配置的帮助信息如下：

[root@kvm-host qemu]# ./configure --help￼ ￼ Usage: configure [options]￼ Options: [defaults in brackets after descriptions]￼ ￼ Standard options:￼     --help                  print this message￼     --prefix=PREFIX         install in PREFIX [/usr/local]￼     --interp-prefix=PREFIX  where to find shared libraries, etc.￼                             use %M for cpu name [/usr/gnemul/qemu-%M]￼     --target-list=LIST      set target list (default: build everything)￼                             Available targets: aarch64-softmmu alpha-softmmu ￼                             arm-softmmu cris-softmmu i386-softmmu lm32-softmmu ￼                             m68k-softmmu microblazeel-softmmu microblaze-softmmu ￼                             mips64el-softmmu mips64-softmmu mipsel-softmmu ￼                             mips-softmmu moxie-softmmu or32-softmmu ￼                             ppc64-softmmu ppcemb-softmmu ppc-softmmu ￼                             s390x-softmmu sh4eb-softmmu sh4-softmmu ￼                             sparc64-softmmu sparc-softmmu tricore-softmmu ￼                             unicore32-softmmu x86_64-softmmu xtensaeb-softmmu ￼                             xtensa-softmmu aarch64-linux-user alpha-linux-user ￼                             armeb-linux-user arm-linux-user cris-linux-user ￼                             i386-linux-user m68k-linux-user ￼                             microblazeel-linux-user microblaze-linux-user ￼                             mips64el-linux-user mips64-linux-user ￼                             mipsel-linux-user mips-linux-user ￼                             mipsn32el-linux-user mipsn32-linux-user ￼                             or32-linux-user ppc64abi32-linux-user ￼                             ppc64le-linux-user ppc64-linux-user ppc-linux-user ￼                             s390x-linux-user sh4eb-linux-user sh4-linux-user ￼                             sparc32plus-linux-user sparc64-linux-user ￼                             sparc-linux-user tilegx-linux-user ￼                             unicore32-linux-user x86_64-linux-user￼ ￼ Advanced options (experts only):￼ <!- 此处省略百余行帮助信息的输出 ->￼ NOTE: The object files are built at the place where configure is launched

以上configure选项中我们特别提一下“--target-list”，它指定QEMU对客户机架构的支持。可以看到，对应的选项非常多，表面上QEMU对客户机的架构类型的支持是非常全面的。由于在本书中（也是多数的实际使用场景）我们只使用x86架构的客户机，因此指定“--target-list=x86_64-softmmu”，可以节省大量的编译时间。
执行configure文件进行配置的过程如下：