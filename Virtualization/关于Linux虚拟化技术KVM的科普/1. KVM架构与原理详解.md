
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [1 KVM架构](#1-kvm架构)

<!-- /code_chunk_output -->

# 1 KVM架构

kvm基本结构有2个部分构成：

kvm 驱动，现在已经是linux kernel的一个模块了。其主要负责虚拟机的创建，虚拟内存的分配，VCPU寄存器的读写以及VCPU的运行。

另个组成是Qemu，用于模拟虚拟机的用户空间组件，提供I/O设备模型，访问外设的途径。

![](./images/2019-06-04-15-01-11.png)

kvm基本结构如上图。

kvm已经是**内核模块**，被看作是一个标准的**linux 字符集设备**（/**dev/kvm**）。Qemu通过**libkvm应用程序接口**，用**fd**通过**ioctl**向设备驱动来发送创建，运行虚拟机命令。设备驱动kvm就会来解析命令（kvm\_dev\_ioctl函数在kvm\_main.c文件中）,如下图：

参考

https://www.linuxidc.com/Linux/2015-01/112328.htm