
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [0 概述](#0-概述)
* [1 宿主机的可扩展性](#1-宿主机的可扩展性)
	* [1.1 硬件实现本身的可扩展性](#11-硬件实现本身的可扩展性)
	* [1.2 系统软件的可扩展性](#12-系统软件的可扩展性)
	* [1.3 存储系统的可扩展性](#13-存储系统的可扩展性)
	* [1.4](#14)

<!-- /code_chunk_output -->

# 0 概述

之前讨论前提都是在VMM上运行一个客户机, 以此为评测对象, 阐述VMM性能评测及其优化的方法. 

接下来, 改变运行虚拟环境的硬件资源(包括增加处理器个数、升级处理器主频、增加内存和磁盘空间等), 在虚拟平台上改变运行客户机的总个数, 观察和分析由此带给VMM性能方面的影响.

一个可扩展性良好的VMM应该能提供更好地性能, 虚拟系统的总体能力应该随着硬件资源的增加按比例增长. 在总体硬件资源不变且每个客户机被分配的资源不变的情况下, 随着客户机运行个数的增加, 每个客户机不能有大的降低, 整个虚拟系统的总体能力应该按比例增长. 

下面从客户机和宿主机两个方面衡量虚拟环境的可扩展性.

# 1 宿主机的可扩展性

宿主机的可扩展性会受到以下几个方面的影响.

## 1.1 硬件实现本身的可扩展性

如图7\-8所示的传统PC结构中, **访问内存**是通过在**北桥上的内存控制器(北桥里面！！！**)完成的, 而**处理器**和**内存控制器**之间由一条叫做**前端总线FSB**的**系统总线**连接. 虽然前端总线的速度由最初的66MHz进化到1333MHz, 但**基本的拓扑逻辑并没有改变**, 随着**处理器数目的不断增加**, 前端总线带宽会逐步成为**瓶颈**. 

因此, 首先可以想象的是, **增加处理器的缓存**就可以在提高**处理器性能**的同时**增加系统的可扩展性**. 

另外, 随着硬件技术的发展, 架构的变化也会带来性能的提高并增加系统的可扩展性, 例如基于**Nehalem的平台**可进一步提高处理器的可扩展性.

![](./images/2019-04-18-10-04-18.png)

**Nehalem内部**集成了**内存控制器**, 通过**独立的内存通道**分别将**本地DDR3内存**与**远程处理器内存相连**, 这样对**每个处理器**就可以**主要访问本地内存**, 避免访问远程内存而导致的瓶颈. 使用新的内存技术DDR3和多条内存通道, 内存带宽比传统的双处理器PC结构提高了数倍. **处理器之间**由**快速路径互连(Quick Path Interconnect, QPI)总线**相连, 共同构成一个NUMA(Non Uniform Memory Access)系统.

## 1.2 系统软件的可扩展性

虽然NUMA系统带来可扩张性的优势, 但由于其对本地和远程内存访问速度不一致性, 系统程序包括操作系统和VMM需要特殊处理以使处理器尽可能使用本地内存, 才能最大程度发挥性能. 例如, 分配空闲内存时, 系统程序应尽可能从处理器本地内存中获取, OS或VMM调度算法尽可能不将应用程序或VCPU调度到非本节点的处理器上.

## 1.3 存储系统的可扩展性

另外, 将服务器和专门的存储系统独立开, 中间通过高速网络相连. 这样, 存储空间很容易扩展, 存储性能也可以通过负载平衡变的更好.

## 1.4 

最后一个需要考虑的宿主机的可扩展性问题是VMM或OS中对于中断处理的开销. 当一个系统的设备增多时, 中断服务开销占处理器的处理时间比例也会上升. 多个频繁产生中断的高速设备(如10G网卡)的中断开销可能让处理器的处理能力饱和.
