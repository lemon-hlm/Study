
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [1 磁盘I/O性能测试工具](#1-磁盘io性能测试工具)
	* [1.1 DD](#11-dd)

<!-- /code_chunk_output -->

# 1 磁盘I/O性能测试工具

在一个计算机系统中，CPU获取**自身缓存数据**的速度非常快，读写内存的速度也比较快，内部局域网速度也比较快（特别是使用万兆以太网），但是磁盘I/O的速度是相对比较慢的。

很多的日常软件的运行都会读写磁盘，而且大型的数据库应用（如Oracle、MySQL等）都是磁盘I/O密集型的应用，所以在**KVM虚拟化**中磁盘I/O的性能也是比较关键的。

测试磁盘I/O性能的工具有很多，如DD、Bonnie\+\+、fio、iometer、hdparm等。下面简单介绍其中几个工具。

## 1.1 DD
DD（命令为dd）是Linux系统上一个非常流行的文件复制工具，在复制文件的同时可以根据其具体选项进行转换和格式化等操作。通过DD工具复制同一个文件（相同数据量）所需要的时间长短即可粗略评估磁盘I/O的性能。一般的Linux系统中都自带这个工具，用man dd命令即可查看DD工具的使用手册。
2.fio
fio是一个被广泛使用的进行磁盘性能及压力测试的工具。它功能强大而灵活，可以用它定义（模拟）出各种工作负载（workload），模拟真实使用场景，以更准确地衡量磁盘的性能。除了测试磁盘读写的带宽以外，它还统计IOPS并且以不同的延迟时间分布表示；除了总的延迟时间，它还分别统计I/O递交的时间延迟和I/O完成的时间延迟。
fio的主页是：http://git.kernel.dk/?p=fio.git;a=summary。它可以运行在Linux、UNIX、Windows等多个操作系统平台上，多数Linux发行版也包含它的安装包。
3.Bonnie++
Bonnie++是以Bonnie￼的代码为基础编写而成的软件，它使用一系列对硬盘驱动器和文件系统的简单测试来衡量其性能。Bonnie++可以模拟像数据库那样去访问一个单一的大文件，也可以模拟像Squid那样创建、读取和删除许许多多的小文件。它可以实现有序地读写一个文件，也可以随机地查找一个文件中的某个部分，而且支持按字符方式和按块方式读写。
4.hdparm
hdparm是一个用于获取和设置SATA和IDE设备参数的工具，在RHEL 7.3中可以用yum install hdparm命令来安装hdparm工具。hdparm也可以粗略地测试磁盘的I/O性能，通过如下的命令即可粗略评估sdb这个磁盘的读性能。

hdparm -tT /dev/sdb

本节选择了DD、FIO、Bonnie++这3种工具用于KVM虚拟化的磁盘I/O性能测试。
10.5.2　测试环境配置
对KVM的磁盘I/O虚拟化性能测试的环境配置，与前面CPU、内存、网络性能测试的环境配置基本相同，下面仅说明一下不同之处和需要强调的地方。
在本次对磁盘I/O的性能测试中，客户机第2块硬盘专门用于磁盘性能测试，这块硬盘是宿主机的一个LVM分区。我们不选择前面通常使用的raw image文件，是为了避免宿主机文件系统这一层的消耗，从而使得客户机与宿主机直接的磁盘性能比较更加公平。如图10-10所示，因为笔者的宿主机环境是LVM分区，所以本节采用中间的一种方式。当然，最右边采用直接的物理硬盘分区的方式层次更简洁，可以预见其绝对性能应该更好。但如同前面几节的测试目标一样，我们这里注重测量虚拟化层的性能损耗，也就是客户机环境中基准测试结果，与同样资源、软件堆栈层次的原生系统中同样基准测试的结果进行对比。