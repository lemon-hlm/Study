# 1 概述

内存虚拟化的主要任务是实现地址空间的虚拟化, **内存虚拟化**通过**两次地址转换**来支持地址空间的虚拟机, 即**客户机虚拟地址GVA**→**客户机物理地址GPA**→**宿主机物理地址HPA**的转换. 

其中, **GVA→GPA**的转换是由**客户机软件决定**, 通常是**客户机OS**通过V**MCS中客户机状态域CR3**指向的**页表**来指定; **GPA→HPA**的转换是由**VMM决定**, VMM在将**物理内存分配给客户机时**就确定了GPA→HPA的转换, VMM通常会用内部数据结构来记录这个关系.

传统的IA32架构只支持一次地址转换, 即通过CR3指定的页表实现"虚拟地址"→"物理地址"的转换. 这和内存虚拟化所要求的两次地址转换产生矛盾. 可通过将两次转换合并成一次转换解决, 即VMM根据GVA→GPA→HPA的映射关系, 计算出GVA→HPA的映射关系, 并将其写入"影子页表". 