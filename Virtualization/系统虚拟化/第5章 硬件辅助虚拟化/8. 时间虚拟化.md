
# 1 OS的时间概念

- 绝对时间(Wall Time): 又称墙上时间. 即OS启动后到目前为止的总运行时间, 它是一个单调递增的值

- 相对时间: 两个时间之间的间隔. 

硬件定时器如RTC、PIT或HPET等都能以某种频率触发时钟中断, 触发频率可以由软件编程控制. 通常, OS会将频率设定为一个给定的值(例如10ms), 从而可以知道两次时钟中断之间的时间差(本例中是10ms). 同时, 硬件定时器也会提供计数器(Counter)的功能, OS可知两次读取计数器之间的时间差, 从而得到相对时间概念.

OS在启动时候读取CMOS的实时时钟, 或通过NPT协议, 得到系统启动时的绝对时间. 同时, 系统通过维护相对时间, 可知系统总运行的事件, 从而OS可得到任意时刻点的绝对时间, 如下公式:

当前绝对时间 = 系统启动时的时间 + 系统启动后运行的时间

图5\-222描述OS的时钟概念. 系统在时间t0时候启动, 当实际时间到达t1的时候, 系统内部维护的运行时间为t1 \- t0, 而系统内部的绝对时间为t0+(t1-t0), 从而保证了内存时间与实际时间的一致性. 每次时钟中断发生时(t1、t2、t3等), OS都会更新内部的时间概念. 而在t1 \~ t2时间内, OS可通过读时间设备的计数器得到相对时间.

![config](./images/34.png)

# 2 客户机的时间概念

在**硬件辅助的虚拟环境**下, 客户机OS仍然需要维护正确地时间概念, 包括**相对时间**和**绝对时间**. 这意味着**VMM**需要为客户机提供**系统硬件时钟设备的仿真**, 包括**PIT**、**HPET**和**TSC**等. 

