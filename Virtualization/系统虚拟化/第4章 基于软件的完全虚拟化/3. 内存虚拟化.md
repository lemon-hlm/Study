
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [0 内存虚拟化的目的](#0-内存虚拟化的目的)
* [1 概述](#1-概述)

<!-- /code_chunk_output -->

# 0 内存虚拟化的目的

内存虚拟化的目的有两个.

- 提供给虚拟机一个从零地址开始的连续物理内存空间.
- 在各虚拟机之间有效隔离、调度和共享内存资源.

# 1 概述

为了让客户机OS使用一个隔离的、从零开始且具有连续性的内存空间, VMM引入一层新的地址空间, 即客户机物理地址空间. 客户机物理地址空间是客户机操作系统所能"看见"和管理的物理地址空间, 这个地址空间不是真正的物理地址空间, 它和物理地址空间还有一个映射. 有了客户机物理地址空间, 就形成了从应用程序所在的客户机虚拟地址(Guest Virtual Address, GVA)到客户机物理地址(Guest Physical Address, GPA), 再从客户机物理地址GPA到宿主机物理地址(Host Physical Address, HPA)的两层地址转换. 前一个转换由客户机OS完成, 后一个转换由VMM负责.

为实现从客户机物理地址GPA到宿主机物理地址HPA的地址翻译, VMM为每个虚拟机动态地维护了一张从客户机物理地址到宿主机物理地址映射关系的表.

有了这张表之后, VMM截获任何试图修改客户机页表或刷新TLB的指令, 根据这张表, 将