一般, 虚拟化环境由三个部分构成: 硬件、VMM和虚拟机. 如图. 在没有虚拟化时, 操作系统直接运行在硬件上, 管理着底层物理硬件, 构成一个完整的计算机系统, 即"物理机". 虚拟环境中, 虚拟机监控器VMM抢占了操作系统的位置, 变成真实物理硬件的管理者, 同时向上层软件呈现出虚拟的硬件平台, 欺骗上层操作系统. 而操作系统运行在虚拟平台上, 仍管理着它认为是"物理硬件"的虚拟硬件, 这就是图中的"虚拟机".

![config](./images/1.png)

上面蕴含了三层含义(同质、高效和资源受控).

先从指令开始着手介绍.

多数现代计算机体系结构都有两个或以上的特权级, 用来分隔系统软件和应用软件. 系统中一些操作和管理关键系统资源的指令会被定为特权指令, 这些指令只有在最高特权级上正确执行. 在非最高特权级上, 特权指令会引发一个异常, 处理器会陷入最高特权级, 交给系统软件来处理. 在不同的运行级上, 不仅指令的执行效果是不同的, 而且不是所有特权指令都会发生异常. 例如一个x86平台的用户违反规范, 在用户态修改EFLAGS寄存器的中断位, 