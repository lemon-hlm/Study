
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [1 虚拟机的动态迁移](#1-虚拟机的动态迁移)
	* [1.1 什么是虚拟机的动态迁移](#11-什么是虚拟机的动态迁移)
	* [1.2 虚拟机动态迁移的特点](#12-虚拟机动态迁移的特点)
* [2 虚拟机快照](#2-虚拟机快照)
	* [2.1 什么是虚拟机快照](#21-什么是虚拟机快照)
	* [2.2 为什么要使用虚拟机快照](#22-为什么要使用虚拟机快照)

<!-- /code_chunk_output -->

# 1 虚拟机的动态迁移

## 1.1 什么是虚拟机的动态迁移

**迁移**, 分为**系统的迁移**和**工作的迁移**. 

- **系统迁移**是指把**整个系统的软件**, 包括**操作系统**, 完全复制到另一个机器上;

- **工作迁移**是指把某台机器上的**一些工作转移到别的机器**上

先看看**传统的无虚拟机**和**有虚拟机的静态迁移**是什么样子的. 

**无虚拟机**下的**系统迁移**是指在没有虚拟机的环境下把一台机器的所有软件, 包括所有状态都复制到另一台机器上. 这种迁移可以通过先做出**系统镜像**, 然后**复制**到其他机器上, 或通过硬盘互相复制的方式来实现迁移.

**无虚拟机**的**工作迁移**则需要**特殊的系统支持**, 如哥伦比亚大学的Zap系统, 通过在操作系统上实现一层薄的虚拟层, 实现工作的**实时迁移**. 

虚拟机的静态迁移指在关闭虚拟机的情况下, 使用文件传输软件将虚拟机的镜像传输到另外的机器上, 然后启动虚拟机. 此种情况下, 不能实现工作的迁移.

最后看看有虚拟机的动态迁移, 所谓虚拟机的**动态迁移**, 是指在**虚拟机运行**的情况下, **实时将虚拟机1迁移到另一个虚拟机2**. 具体讲, 就是将**物理服务器A**上的**内存**里的**所有关于虚拟机1的信息**全部**封包通过网络移交到物理服务器B**上, 从而**形成新的虚拟机2**. 这是一个内存信息的移交与转换的过程, 速度快, 其唯一限制就是网络带宽与突然停电之类的突发情况. 这种模式下, 如果**VMM只把某些工作的信息**传送给**其它虚拟机**中, 则可以实现**工作的实时迁移**.

## 1.2 虚拟机动态迁移的特点

虚拟机的动态迁移具有如下优点

⓵ 在**非停机情况**下进行**迁移**, 可实现**在线的系统维护**, 提高系统的**可维护性**, 优化系统中的**资源分配**, 以及通过将**不正常工作的宿主机**的工作迁移到**正常工作的宿主机**中实现**高可用性**

⓶ 前面提到, 虚拟化去掉了硬件的相关性, 从而实现不同硬件上的虚拟机之间的动态迁移, 极大扩大了可迁移的面, 使虚拟机的动态迁移在实用性方面较之以前的方法有很大进步.

⓷ 虚拟机通常将硬件资源抽象成一个或一些文件, 极大简化了虚拟机之间迁移的配置过程, 更进一步, 虚拟机之间的迁移还可以通过配置管理工具自行进行管理, 提高了系统的可维护性.

⓸ 通过迁移管理工具, 可详细记录迁移, 保持追踪, 从而在出问题时候有依据.

还可以指定某一时刻进行迁移工作.

# 2 虚拟机快照

## 2.1 什么是虚拟机快照

就是将**某一个时刻**虚拟机的**状态**像照片一样保存下来. 通常, 快照将要保存所有的**硬盘信息**、**内存信息！！！**和**CPU信息**, VMware还将保存BIOS信息.

## 2.2 为什么要使用虚拟机快照

虚拟机快照用在很多地方, 包括测试、备份和安全等. 

测试, 想测试一个新软件, 并不知道软件将会对系统产生什么影响. 在测试之前做过快照, 有问题只需要回滚到快照之前.

备份, 可定期做虚拟机快照并将快照产生的文件保存在备份盘上面. 听起来类似于Ghost备份, 但使用虚拟机的快照有以下优点:

⓵ 备份可以由虚拟机管理工具实现, 可定时备份等.

⓶ 