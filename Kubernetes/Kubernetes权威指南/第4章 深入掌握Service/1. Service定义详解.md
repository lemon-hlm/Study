
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [2 Service的基本用法](#2-service的基本用法)

<!-- /code_chunk_output -->

YAML格式的Service定义文件的完整内容如下：

```yaml
apiVersion: v1          # Required
kind: Service           # Required
metadata:               # Required
  name: string          # Required
  namespace: string     # Required
  labels: 
    - name: string
  annotations:
    - name: string
spec:                   # Required
  selector: []          # Required
  type: string          # Required
  clusterIP: string
  sessionAffinity: string
  ports:
  - name: string
    protocol: string
    port: int
    targetPort: int
    nodePort: int
  status:
    loadBalancer:
      ingress:
        ip: string
        hostname: string
```

对各属性的说明如表4.1所示。

表4.1　对Service的定义文件模板的各属性的说明:

![2019-08-29-20-12-16.png](./images/2019-08-29-20-12-16.png)

![2019-08-29-20-12-28.png](./images/2019-08-29-20-12-28.png)

# 2 Service的基本用法

一般来说，**对外提供服务的应用程序**需要通过**某种机制**来实现，对于**容器应用**最简便的方式就是通过**TCP/IP机制**及**监听IP和端口号**来实现。

例如，定义一个**提供Web服务的RC**，由**两个Tomcat容器副本**组成，**每个容器**都通过**containerPort设置**提供服务的端口号为8080：

```yaml
# webapp-rc.yaml
---
apiVersion: v1
kind: ReplicationController
metadata:
  name: webapp
spec:
  replicas: 2
  template:
    metadata:
      name: webapp
      labels:
        app: webapp
    spec:
      containers:
      - name: webapp
        image: tomcat
        ports:
        - containerPort: 8080
```

创建该RC:

```
# kubectl create -f webapp-rc.yaml
replicationcontroller "webapp" created
```

获取Pod的IP地址：

```
# kubectl get pods -l app=webapp -o yaml | grep podIP
    podIP: 172.17.1.4
    podIP: 172.17.1.3
```

可以直接通过这两个Pod的IP地址和端口号访问Tomcat服务：

```
# curl 172.17.1.3:8080
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>
```