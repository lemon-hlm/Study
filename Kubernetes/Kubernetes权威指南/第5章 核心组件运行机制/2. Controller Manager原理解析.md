
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [1. 概述](#1-概述)
  - [1.1. 作用: 自动修正系统](#11-作用-自动修正系统)
  - [1.2. Controller Manager结构](#12-controller-manager结构)
  - [1.3. Scheduler作用](#13-scheduler作用)
- [Replication Controller](#replication-controller)

<!-- /code_chunk_output -->

# 1. 概述

## 1.1. 作用: 自动修正系统

一般来说，**智能系统**和**自动系统**通常会通过一个“**操作系统**”来**不断修正系统的工作状态**。

在Kubernetes集群中，**每个Controller！！！** 都是这样的一个“**操作系统**”，它们通过**API Server**提供的（**List\-Watch）接口**实时监控集群中**特定资源的状态变化**，当发生**各种故障**导致**某资源对象的状态发生变化**时，Controller会尝试将其状态调整为期望的状态。

比如当**某个Node意外宕机**时，**Node Controller**会及时发现此故障并**执行自动化修复流程**，确保集群始终处于预期的工作状态。**Controller Manager**是Kubernetes中**各种操作系统的管理者**，是集群内部的**管理控制中心**，也是Kubernetes自动化功能的核心。

## 1.2. Controller Manager结构

如图5.7所示，**Controller Manager**内部包含**Replication Controller**、Node Controller、ResourceQuota Controller、Namespace Controller、ServiceAccount Controller、Token Controller、Service Controller及Endpoint Controller这**8种Controller**，**每种Controller**都负责**一种特定资源的控制流程**，而**Controller Manager**正是**这些Controller**的**核心管理者！！！**。

图5.7　Controller Manager结构图:

![2019-09-01-16-41-46.png](./images/2019-09-01-16-41-46.png)

由于**ServiceAccount Controller**与**Token Controller**是与**安全相关的两个控制器**，并且与Service Account、Token密切相关，所以我们将对它们的分析放到后面讲解。

## 1.3. Scheduler作用

在Kubernetes集群中与Controller Manager并重的另一个组件是Kubernetes **Scheduler**，它的作用是将**待调度的Pod**（包括通过API Server新创建的Pod及RC为补足副本而创建的Pod等）通过一些复杂的调度流程**计算出最佳目标节点**，然后**绑定到该节点**上。本章最后会介绍Kubernetes Scheduler调度器的基本原理。

# Replication Controller

为了区分**Controller Manager**中的**Replication Controller（副本控制器！！！**）和**资源对象Replication Controller！！！**，我们将**资源对象Replication Controller**简写为**RC**，而本节中的Replication Controller是指“副本控制器”，以便于后续分析。