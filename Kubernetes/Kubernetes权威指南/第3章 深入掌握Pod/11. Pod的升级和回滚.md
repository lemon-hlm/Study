
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [1 Deployment的升级](#1-deployment的升级)

<!-- /code_chunk_output -->

当集群中的**某个服务需要升级**时，我们需要**停止**目前**与该服务相关**的**所有Pod**，然后**下载新版本镜像**并**创建新的Pod**。如果集群**规模比较大**，则这个工作变成了一个挑战，而且先全部停止然后逐步升级的方式会导致**较长时间的服务不可用**。

Kubernetes提供了**滚动升级**功能来解决上述问题。

如果**Pod**是通过**Deployment创建**的，则用户可以在**运行时**修改Deployment的**Pod定义**（**spec.template**）或**镜像名称**，并应用到Deployment对象上，系统即可完成Deployment的自动更新操作。如果在更新过程中发生了错误，则还可以通过回滚操作恢复Pod的版本。

# 1 Deployment的升级

以Deployment nginx为例：

```yaml

---
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.7.9
        ports:
        - containerPort: 80
```

