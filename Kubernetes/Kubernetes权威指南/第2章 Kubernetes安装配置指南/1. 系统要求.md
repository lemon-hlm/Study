
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [docker安装](#docker安装)

<!-- /code_chunk_output -->

Kubernetes系统由一组可执行程序组成，用户可以通过GitHub上的Kubernetes项目页**下载编译好的二进制包**，或者**下载源代码并编译后进行安装**。

安装Kubernetes对软件和硬件的系统要求如表2.1所示。

![2019-08-14-15-29-47.png](./images/2019-08-14-15-29-47.png)

Kubernetes需要容器运行时（Container Runtime Interface，CRI）的支持，目前官方支持的容器运行时包括：Docker、Containerd、CRI\-O和frakti。容器运行时CRI的原理详见3.9节的说明。本节以Docker作为容器运行环境.

宿主机操作系统以CentOS Linux 7为例，使用Systemd系统完成对Kubernetes服务的配置。其他Linux发行版的服务配置请参考相关的系统管理手册。为了便于管理，常见的做法是将Kubernetes服务程序配置为Linux系统开机自启动的服务。

需要注意的是，CentOS Linux 7默认启动了防火墙服务（firewalld），而Kubernetes的Master与工作Node之间会有大量的网络通信，安全的做法是在防火墙上配置各组件需要相互通信的端口号，具体要配置的端口号详见2.8节各服务启动参数中监听的端口号。

可以关闭防火墙服务

```
# systemctl disable firewalld
# systemctl stop firewalld
```

另, 建议主机上禁用SELinux, 让容器可以读取主机文件系统:

```
# setenforce 0
```

或修改系统文件/etc/sysconfig/selinux, 将SELINUX=enforcing改成SELINUX=disabled, 然后重启Linux.

# docker安装

Docker可以安装在Windows、Linux、Mac等各个平台上。具体可以查看文档[Install Docker](https://docs.docker.com/install/)。也可以查看国内镜像源的安装方式, 比如[清华镜像源](https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/)

先卸载旧版本

```
# sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
```

安装依赖包. `yum\-utils`提供`yum\-config\-manager`组件, `device\-mapper\-persistent\-data` 和 `lvm2`是被devicemapper存储驱动依赖.

```
# sudo yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2
```

下载repo文件

```
# wget -O /etc/yum.repos.d/docker-ce.repo http://mirrors.tencent.com/docker-ce/linux/centos/docker-ce.repo
# sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
```

将仓库地址修改为国内源, 比如tuna或腾讯

```
# sudo sed -i 's+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+' /etc/yum.repos.d/docker-ce.repo
# sudo sed -i 's+download.docker.com+mirrors.tencent.com/docker-ce+' /etc/yum.repos.d/docker-ce.repo
```

更新yum缓存

```
# sudo yum makecache
```

安装docker engine

```
# sudo yum install docker-ce docker-ce-cli containerd.io
```

Docker 需要用户具有 sudo 权限，为了避免每次命令都输入sudo，可以把用户加入 Docker 用户组

```
# sudo usermod -aG docker $USER
```











```
# 将桥接的IPV4流量传递到iptables的链
[root@master01 ~]# cat > /etc/sysctl.d/k8s.conf << EOF
> net.bridge.bridge-nf-call-iptables = 1
> net.bridge.bridge-nf-call-ip6tables = 1
> EOF

# sysctl --system
```

```
kubeadm init --apiserver-advertise-address=192.168.56.11 --image-repository registry.aliyuncs.com/google_containers --service-cidr=192.168.0.0/16 --pod-network-cidr=192.168.0.0/16
```


```
journalctl -xeu kubelet
```

