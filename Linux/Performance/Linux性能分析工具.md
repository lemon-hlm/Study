[TOC]

首先来看一张图：

![config](./images/1.jpg)

上图是Brendan Gregg 的一次性能分析的分享，这里面的所有工具都可以通过man来获得它的帮助文档，下面简单介绍介绍一下常规的用法：

# 1 vmstat -- 虚拟内存统计

vmstat(VirtualMeomoryStatistics,虚拟内存统计) 是Linux中监控内存的常用工具,可对操作系统的虚拟内存、进程、CPU等的整体情况进行监视。

vmstat的常规用法：vmstat interval times即每隔interval秒采样一次，共采样times次，如果省略times,则一直采集数据，直到用户手动停止为止。 简单举个例子：

```
[root@localhost ~]# vmstat 5
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 12410676   3436 3086804    0    0     0     1    1    3  0  1 99  0  0
 0  0      0 12410668   3436 3086840    0    0     0     2   54   47  0  0 100  0  0
 0  0      0 12410668   3436 3086840    0    0     0     0   45   40  0  0 100  0  0
 0  0      0 12410676   3436 3086840    0    0     0     0   50   46  0  0 100  0  0
^C
```

可以使用ctrl+c停止vmstat采集数据。

第一行显示了**系统自启动以来的平均值**，第二行开始显示现在正在发生的情况，接下来的行会显示每5秒间隔发生了什么，每一列的含义在头部，如下所示：

procs：r这一列显示了多少进程在等待cpu，b列显示多少进程正在不可中断的休眠（等待IO）。

memory：swapd列显示了**多少块被换出了磁盘（页面交换**），剩下的列显示了多少块是空闲的（未被使用），多少块正在被用作缓冲区，以及多少正在被用作操作系统的缓存。

swap：显示交换活动：每秒有多少块正在被换入（从磁盘）和换出（到磁盘）。

io：显示了多少块从块设备读取（bi）和写出（bo）,通常反映了硬盘I/O。

system：显示每秒中断(in)和上下文切换（cs）的数量。

cpu：显示所有的cpu时间花费在各类操作的百分比，包括执行用户代码（非内核），执行系统代码（内核），空闲以及等待IO。

内存不足的表现：free memory急剧减少，回收buffer和cacher也无济于事，大量使用交换分区（swpd）,页面交换（swap）频繁，读写磁盘数量（io）增多，缺页中断（in）增多，上下文切换（cs）次数增多，等待IO的进程数（b）增多，大量CPU时间用于等待IO（wa）