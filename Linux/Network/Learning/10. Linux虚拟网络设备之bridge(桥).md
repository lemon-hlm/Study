[TOC]

# 1 什么是bridge？

总结: 虚拟网络设备和虚拟交换机

首先，**bridge**是一个**虚拟网络设备！！！**，所以具有**网络设备的特征**，可以**配置IP**、**MAC地址(！！！**)等；其次，bridge是一个**虚拟交换机！！！**，和物理交换机有类似的功能。

对于**普通的网络设备！！！**来说，只有**两端**，从一端进来的数据会从另一端出去，如**物理网卡**从**外面网络**中收到的**数据**会转发给**内核协议栈**，而从**协议栈**过来的**数据**会转发到外面的**物理网络**中。

而bridge不同，**bridge有多个端口**，数据可以从**任何端口**进来，进来之后从哪个口出去和物理交换机的原理差不多，要**看mac地址**。

# 2 创建bridge

先用iproute2创建一个bridge:

```
dev@debian:~$ sudo ip link add name br0 type bridge
dev@debian:~$ sudo ip link set br0 up
```

创建一个bridge后, 它是一个独立的网络设备, 只有一个端口连着协议栈, 其它的端口什么都没连, 这时候bridge没任何功能. 如图: 

```
+----------------------------------------------------------------+
|                                                                |
|       +------------------------------------------------+       |
|       |             Newwork Protocol Stack             |       |
|       +------------------------------------------------+       |
|              ↑                                ↑                |
|..............|................................|................|
|              ↓                                ↓                |
|        +----------+                     +------------+         |
|        |   eth0   |                     |     br0    |         |
|        +----------+                     +------------+         |
| 192.168.3.21 ↑                                                 |
|              |                                                 |
|              |                                                 |
+--------------|-------------------------------------------------+
               ↓
         Physical Network
```

>这里假设eth0是我们的物理网卡，IP地址是192.168.3.21，网关是192.168.3.1

# 3 将bridge和veth设备相连

创建一对veth设备，并配置上IP

