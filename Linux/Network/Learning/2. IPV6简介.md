[TOC]

https://segmentfault.com/a/1190000008794218

# 1 为什么需要IPV6

**全球的IP地址**由一个名字叫**IANA（Internet Assigned Numbers Authority**）的机构管理，在它下面有**5个分管机构**，名字叫分别叫**AFRINIC**、**APNIC**、**ARIN**、**PIPE NCC**和**LACNIC**，他们分别负责全球**五个不同地区的IP地址分配**，中国就归**APNIC**管。

**IANA**只负责将**IP地址**分配给下面的**5个分管机构**，分管机构再负责将IP地址分配给相关地区的网络运营商或者研究机构等。

**IPv4**的长度只有**32位**，总共约42亿的地址，除去预**留的大约6亿地址**外，实际在公网中可以被使用的地址大约只有36亿，而据最新统计，世界人口已经超过了70亿，并且截至2016年，人们正在使用的智能手机数量已经超过了20亿。

截至**2011年01月31日**，IANA已经将**所有的IP地址**分配给了下面的**5个分管机构**，而到2011年04月15日，**APNIC的IP地址已经全部分配完**了，就是说，如果我们的中国电信、移动和联通的IP地址不够用的话，已经没有地方可以申请更多的IP地址了。

很明显，如果每个设备都用一个公网IP的话，IPv4早就不够用了，虽然现在用**NAT的方式**还能坚持一段时间，但终究不是长久之策，我们需要一个更大的IP地址空间。

# 2 IPV6的优点

## 2.1 更大的地址空间

名字叫IPv6，但它的长度并不是64位，而是**128位**，总的地址空间大约为3.4*10^38，一个亿是10的8次方，那么IPv6就有340万亿亿亿亿个地址（4个亿连一起），所以说给地球上的每一粒沙子分配一个IP地址不是在吹牛，是真可以。

可以参考[这篇文章](https://itsnobody.wordpress.com/2012/02/17/how-many-addresses-can-ipv6-hold/)和[这篇文章](http://www.npr.org/sections/krulwich/2012/09/17/161096233/which-is-greater-the-number-of-sand-grains-on-earth-or-stars-in-the-sky)，里面提到地球上所有沙滩的沙子大约有7.5*10^18粒，这个值跟IPv6的10^38相差了很多个数量级，就算加上沙漠等其它的地方，IPv6的数量也足够覆盖它。

## 2.2 点到点通信更方便

IPv6完全有能力为联网的**每个设备分配一个公网IP**，于是我们可以**不再需要NAT**，从而非常方便的实现**点到点的直接通信**。

说好处之前，先了解一下**NAT的缺点**：

- 使用了NAT之后，**每次通信**都要做一次**NAT转换**，影响性能。

- 处于**两个不同NAT网络**内部的机器**不能直接通信**，他们之间的通信得依赖第三方的服务器，极大的限制了网络的连通性，同时所有的数据都会被第三方所监控。

- 为了支持NAT，很多网络协议变得很复杂，大大增加了网络的复杂性。

没有了NAT之后，当然上面的这些缺点也就没有了，同时会带来下面这些比较直观的好处：

- 更方便： 想象一下，每个电脑都有公网IP，你电脑出了点问题，找我帮忙看一下，只要把你的IP给我，我就可以连上去了，而我们现在的情况是，两个人都是内网IP，没法直接访问，非得用QQ共享桌面之类的软件。

- 更安全： 配合点到点的加密，让网络更安全，不给第三方监听的机会； 以网络聊天为例，通过使用点到点的聊天软件，就不用担心被人监听聊天记录了；同时访问家里的摄像头不再需要经过第三方服务器，不用担心给别人看直播了。

## 2.3 IP配置更方便

IPv6有一个功能叫**Stateless Auto Configuration**，简单点说，就是可以**不借助DHCP服务器**实现**IP地址的分配**，插上网线就能上网。

系统起来后，就会为每个网卡生成一个Link-Local的IP地址，简单点说就是一个固定的前缀加上mac地址，由于mac地址全球唯一，所以这样构成的IP地址是唯一的，有了这个地址后，就可以局域网进行通信了，但是这种地址路由器是不会转发的。

如果网络里有路由器； 系统会通过广播的方式问路由器，路由器会返回一个子网前缀，类似于IPv4里面的192.168.0.0/16，系统将子网前缀和mac地址组合起来，构成了一个唯一的IP地址，这个IP地址可以通过路由器路由。

也就是说，就算不做任何配置，系统启动起来后，网卡就一定会有IPv6地址，有了IPv6地址就可以通信。

当然IP地址也可以由DHCP6服务器来分配，这种方式分配叫做Stateful Auto Configuration。

局域网内更安全
由Neighbor Discovery代替了IPv4里面的ARP协议，没有ARP后，跟ARP相关的攻击就不存在了

路由更快
