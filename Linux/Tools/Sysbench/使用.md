
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [1 安装](#1-安装)
  - [1.1 二进制包安装](#11-二进制包安装)
  - [1.2 源码安装](#12-源码安装)
- [2 使用](#2-使用)

<!-- /code_chunk_output -->

# 1 安装

参照github README

## 1.1 二进制包安装

```
# curl -s https://packagecloud.io/install/repositories/akopytov/sysbench/script.rpm.sh | sudo bash
# sudo yum -y install sysbench
```

## 1.2 源码安装

安装依赖

```
yum -y install make automake libtool pkgconfig libaio-devel
# For MySQL support, replace with mysql-devel on RHEL/CentOS 5
yum -y install mariadb-devel openssl-devel
# For PostgreSQL support
yum -y install postgresql-devel
```

编译安装

```
./autogen.sh
# Add --with-pgsql to build with PostgreSQL support
./configure
make -j
make install
```

如果出现`perl: warning: Falling back to the standard locale ("C")`, 需要设置locale

```
echo "export LC_ALL=C" >> /root/.bashrc
source /root/.bashrc
```

要是没有安装开发包，即/usr/include/ 目录下面没有mysql文件夹。则需要执行安装:

```

```

# 2 使用

执行sysbench \–help，可以看到sysbench的详细使用方法。


```
sysbench [options]... [testname] [command] 
```

（1）command

command是sysbench要执行的命令，包括prepare、run、cleanup和help，顾名思义，

- prepare是为测试(某些测试才需要)提前准备数据，比如, 为`fileio`生成必要的文件, 为数据库benchmark填充测试数据
- run是执行正式的测试，
- cleanup是在测试完成后对产生的临时数据进行清理
- help: 针对`testname`显示帮助信息. 

（2）testname

testname指定了要进行的测试，在老版本的sysbench中，可以通过\-\-test参数指定测试的脚本；而在新版本中，--test参数已经声明为废弃，可以不使用\-\-test，而是直接指定脚本。

例如，如下两种方法效果是一样的：

```
sysbench --test=./tests/include/oltp_legacy/oltp.lua
sysbench ./tests/include/oltp_legacy/oltp.lua
```

测试时使用的脚本为lua脚本，可以**使用sysbench自带脚本**，也可以自己开发。对于大多数应用，使用sysbench自带的脚本就足够了。不同版本的sysbench中，lua脚本的位置可能不同，可以自己在sysbench路径下使用find命令搜索**oltp.lua**。

P.S.：大多数数据服务都是oltp类型的，如果你不了解什么是oltp，那么大概率你的数据服务就是oltp类型的。