
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [1 安装yum源](#1-安装yum源)
- [2 安装PostgreSQL](#2-安装postgresql)
- [3 初始化数据库](#3-初始化数据库)
- [4 配置数据库](#4-配置数据库)
- [5 管理服务](#5-管理服务)
- [6 登录PostgreSQL](#6-登录postgresql)
- [7 常用命令介绍](#7-常用命令介绍)

<!-- /code_chunk_output -->

# 1 安装yum源

地址从 http://yum.postgresql.org/repopackages.php 获取

```
# yum install https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-7.6-x86_64/pgdg-centos11-11-2.noarch.rpm

# rpm -ql pgdg-redhat-repo-42.0-4.noarch
/etc/pki/rpm-gpg
/etc/pki/rpm-gpg/RPM-GPG-KEY-PGDG
/etc/yum.repos.d/pgdg-redhat-all.repo
```

# 2 安装PostgreSQL

```
# yum install postgresql-server postgresql-contrib
```

# 3 初始化数据库

```
# postgresql-setup initdb
```

# 4 配置数据库

默认情况下PostgreSQL不支持密码登录，如需支持需要修改配置文件

将未注释行中的ident 替换为 md5

```
# vim /var/lib/pgsql/data/pg_hba.conf

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             all                                     peer
# IPv4 local connections:
host    all             all             127.0.0.1/32            ident
# IPv6 local connections:
host    all             all             ::1/128                 ident
# Allow replication connections from localhost, by a user with the
# replication privilege.
#local   replication     postgres                                peer
#host    replication     postgres        127.0.0.1/32            ident
#host    replication     postgres        ::1/128                 ident
```

如需开启远程访问，可编辑/var/lib/pgsql/data/postgresql.conf, 将`#listen_addresses = 'localhost'`修改为`listen_addresses='*'`(当然, ，此处‘\*'也可以改为任何你想开放的服务器IP)

另外对于特定的IP还可以设置开启信任远程连接,修改/var/lib/pgsql/data/pg\_hba.conf，按下面的格式进行添加设置。

```
# IPv4 local connections:
 host all   all  127.0.0.1/32  trust
 host all   all  8.8.8.8/32（需要连接的服务器IP） trust
```

```
systemctl restart postgresql
```

# 5 管理服务

```
systemctl start postgresql
systemctl restart postgresql
systemctl stop postgresql
systemctl enable postgresql
```

# 6 登录PostgreSQL

PostgreSQL 安装完成后，会建立一下‘**postgres**'用户，用于**执行PostgreSQL**，数据库中也会建立一个'postgres'用户，如果我们要**使用PostgreSQL**就必须**先登录此帐号**。

```
# sudo -i -u postgres
```

然后执行"psql"进入postgresql命令行环境

```
[root@gerry ~]# sudo -i -u postgres
-bash-4.2$ psql
psql (9.2.24)
输入 "help" 来获取帮助信息.

postgres=#
```

接着可以执行ALTER USER postgres WITH PASSWORD '123456'来设置postgres用户密码，可通过\q退出数据库

# 7 常用命令介绍